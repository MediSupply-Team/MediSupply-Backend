#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘           GUÃA PARA VERIFICAR PRECARGA DE DATOS EN AWS                       â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“‹ PASO 1: VERIFICAR LOGS DE CONTENEDORES EN AWS"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ” Para ECS (Elastic Container Service):"
echo "   1. Ve a la consola de AWS â†’ ECS"
echo "   2. Selecciona tu cluster"
echo "   3. Selecciona el servicio (cliente-service o catalog-service)"
echo "   4. Ve a la pestaÃ±a 'Logs' o 'CloudWatch Logs'"
echo "   5. Busca lÃ­neas como:"
echo "      â€¢ âœ… INICIALIZACIÃ“N COMPLETADA EXITOSAMENTE"
echo "      â€¢ âœ… Clientes: X registros"
echo "      â€¢ âœ… Vendedores: X registros"
echo "      â€¢ âœ… Productos: X registros"
echo ""
echo "ğŸ“± Comando AWS CLI para ver logs:"
echo "   # Cliente Service"
echo "   aws logs tail /ecs/cliente-service --follow"
echo ""
echo "   # Catalog Service"
echo "   aws logs tail /ecs/catalog-service --follow"
echo ""
echo ""
echo "ğŸ“‹ PASO 2: VERIFICAR DATOS VÃA API"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Reemplaza <URL_AWS> con tu URL de AWS (ALB o API Gateway):"
echo ""
echo "# 1. Verificar Vendedores (3 con UUID hardcodeado)"
echo "curl https://<URL_AWS>/api/v1/vendedores/ | jq '.items | length'"
echo ""
echo "# 2. Verificar Clientes (6 con UUID hardcodeado)"
echo "curl https://<URL_AWS>/api/v1/client/ | jq 'length'"
echo ""
echo "# 3. Verificar Productos (20 productos precargados)"
echo "curl https://<URL_AWS>/api/v1/catalog/items | jq '.items | length'"
echo ""
echo "# 4. Verificar vendedor especÃ­fico (Carlos Mendoza)"
echo "curl https://<URL_AWS>/api/v1/vendedores/11111111-1111-1111-1111-111111111111"
echo ""
echo "# 5. Verificar clientes de un vendedor"
echo "curl https://<URL_AWS>/api/v1/client/?vendedor_id=11111111-1111-1111-1111-111111111111"
echo ""
echo ""
echo "ğŸ“‹ PASO 3: CONECTARSE DIRECTAMENTE A LA BASE DE DATOS"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ—„ï¸ Conectar a RDS de Cliente Service:"
echo "   psql -h <RDS_ENDPOINT> -U cliente_user -d cliente_db"
echo ""
echo "   Luego ejecuta:"
echo "   SELECT COUNT(*) FROM vendedor;  -- Debe retornar 5 (3 hardcoded + 2 extras)"
echo "   SELECT COUNT(*) FROM cliente;   -- Debe retornar 6+ (6 hardcoded + creados)"
echo "   SELECT id, nombre_completo FROM vendedor WHERE id::text LIKE '11111111%';"
echo ""
echo "ğŸ—„ï¸ Conectar a RDS de Catalog Service:"
echo "   psql -h <RDS_ENDPOINT> -U catalogo_user -d catalogo_db"
echo ""
echo "   Luego ejecuta:"
echo "   SELECT COUNT(*) FROM producto;   -- Debe retornar 20+"
echo "   SELECT COUNT(*) FROM inventario;  -- Debe retornar inventarios"
echo "   SELECT id, nombre FROM producto LIMIT 5;"
echo ""
echo ""
echo "ğŸ“‹ PASO 4: SI LOS DATOS NO SE CARGARON AUTOMÃTICAMENTE"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ”§ OpciÃ³n A: Reiniciar el servicio en ECS"
echo "   aws ecs update-service --cluster <CLUSTER> --service cliente-service --force-new-deployment"
echo "   aws ecs update-service --cluster <CLUSTER> --service catalog-service --force-new-deployment"
echo ""
echo "ğŸ”§ OpciÃ³n B: Ejecutar manualmente desde un contenedor temporal"
echo "   # Obtener el endpoint de RDS"
echo "   export DATABASE_URL='postgresql+asyncpg://usuario:password@rds-endpoint:5432/database'"
echo ""
echo "   # Cliente Service"
echo "   docker run -it --rm \\"
echo "     -e DATABASE_URL=\"\$DATABASE_URL\" \\"
echo "     <ECR_REGISTRY>/cliente-service:latest \\"
echo "     python3 -m app.populate_db"
echo ""
echo "   # Catalog Service"
echo "   docker run -it --rm \\"
echo "     -e DATABASE_URL=\"\$DATABASE_URL\" \\"
echo "     <ECR_REGISTRY>/catalog-service:latest \\"
echo "     python3 -m app.db_init"
echo ""
echo ""
echo "ğŸ“‹ PASO 5: VARIABLES DE ENTORNO CRÃTICAS EN AWS"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Verifica que estas variables estÃ©n configuradas en ECS Task Definition:"
echo ""
echo "âœ… cliente-service:"
echo "   DATABASE_URL=postgresql+asyncpg://cliente_user:<PASSWORD>@<RDS_ENDPOINT>:5432/cliente_db"
echo ""
echo "âœ… catalog-service:"
echo "   DATABASE_URL=postgresql+asyncpg://catalogo_user:<PASSWORD>@<RDS_ENDPOINT>:5432/catalogo_db"
echo ""
echo "âš ï¸  IMPORTANTE: La contraseÃ±a NO debe tener caracteres especiales sin escapar"
echo "   Si tiene caracteres especiales, usa URL encoding: @ = %40, # = %23, etc."
echo ""
echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                     âœ… DATOS QUE SE DEBEN PRECARGAR                          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ¯ VENDEDORES (3 con UUID hardcodeado):"
echo "   â€¢ Carlos Mendoza (11111111-1111-1111-1111-111111111111)"
echo "   â€¢ MarÃ­a FernÃ¡ndez (22222222-2222-2222-2222-222222222222)"
echo "   â€¢ AndrÃ©s RamÃ­rez (33333333-3333-3333-3333-333333333333)"
echo ""
echo "ğŸ¯ CLIENTES (6 con UUID hardcodeado y vendedor asignado):"
echo "   â€¢ 2 clientes para Carlos Mendoza"
echo "   â€¢ 2 clientes para MarÃ­a FernÃ¡ndez"
echo "   â€¢ 2 clientes para AndrÃ©s RamÃ­rez"
echo ""
echo "ğŸ¯ PRODUCTOS (20 con UUID hardcodeado):"
echo "   â€¢ Amoxicilina (11111111-1111-1111-1111-000000000001)"
echo "   â€¢ Ibuprofeno (11111111-1111-1111-1111-000000000002)"
echo "   â€¢ ... (18 productos mÃ¡s)"
echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘        ğŸ‰ SIGUE ESTOS PASOS PARA VERIFICAR LA PRECARGA EN AWS               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

